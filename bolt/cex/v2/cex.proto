syntax = "proto3";

package bolt.cex.v2;

import "bolt/assets/v1/assets.proto";

// Service adapting the CEX communication for Bolt protocol
service CEXService {
  // Deposits specified amount to the given CEX address
  // This is used by the MM to deposit funds to the CEX for rebalancing purposes
  // The MM will withdraw the assets into the address of CEX service and the Deposit method will
  // be called by the MM to send the tokens to the CEX's deposit address (with any memo if needed)
  // Cosmos: Depositing involves sending the tokens from Archway chain to the asset's native chain (e.g. ATOM to Cosmos Hub) and from there to the CEX deposit address
  // Sui: Depositing involves sending tokens from the chain to the CEX deposit address
  // Solana: Depositing involves sending tokens from the chain to the CEX deposit address
  // EVM: Depositing involves sending tokens from the chain to the CEX deposit address
  rpc Deposit(DepositRequest) returns (DepositResponse);
  // Withdraws tokens from CEX to chain address
  // This is used by the MM to withdraw funds from the CEX back to account of the MM on the chain
  // Cosmos: Withdrawing involves sending tokens from asset's native chain (e.g. Cosmos Hub) to the Archway chain address via ICS20 and ICA
  // Sui: Not needed as tokens can be withdrawn directly to Sui address
  // Solana: Not needed as tokens can be withdrawn directly to Solana address
  // EVM: Not needed as tokens can be withdrawn directly to EVM address
  rpc Withdraw(WithdrawRequest) returns (WithdrawResponse);
  // Endpoint to get the withdraw address for CEX to send funds to
  // This is used by the MM to figure out which address it should ask the CEX to withdraw funds to
  // Cosmos: The withdraw address is the ICA address on the asset's native chain (e.g. Cosmos Hub)
  // Sui: The withdraw address is the Sui address of the CEX service
  // Solana: The withdraw address is the Solana address of the CEX service
  // EVM: The withdraw address is the EVM address of the CEX service
  rpc GetWithdrawAddress(GetWithdrawAddressRequest) returns (GetWithdrawAddressResponse);
  // Endpoint to get the information about the network the CEX service is running on
  rpc Info(InfoRequest) returns (InfoResponse);
}

// Request to deposit funds to the CEX
message DepositRequest {
  // to_address: The address to which the funds should be deposited. This is provided by the CEX
  DepositAddress to_address = 1;
  // amount: The amount to be deposited
  bolt.assets.v1.Balance amount = 2;
}

// Response to DepositRequest. Doesn't respond anything on success.
message DepositResponse {}

// Request to withdraw funds from the CEX
message WithdrawRequest {
  // address: The address to which the funds should be withdrawn
  string address = 1;
  // amount: The amount to be withdrawn
  bolt.assets.v1.Balance amount = 2;
}

// Response to WithdrawRequest. Doesn't respond anything on success.
message WithdrawResponse {}

// Request to get the withdraw address used by the CEX service
message GetWithdrawAddressRequest {
  // asset: The name of the asset for which to get the withdraw address
  string asset = 1;
}

// Response to GetWithdrawAddressRequest. Contains the withdraw address used by the CEX service
message GetWithdrawAddressResponse {
  // address: The withdraw address used by the CEX service
  string address = 1;
  // chain_id: The chain id of the chain the withdraw address is for
  string chain_id = 2;
}

// Request to get information about the CEX service
message InfoRequest {}

// Response to the InfoRequest. Contains information about which chain the CEX service is running on and the address of the signer.
message InfoResponse {
  // chain_id: The chain id of the chain the CEX service is running on. e.g. archway-1
  string chain_id = 1;
  // whoami: The address of the signer who will be submitting transactions for sending and receiving funds from the chain
  string whoami = 2;
}

// Deposit address structure containing address and optional memo
message DepositAddress {
  // address: The deposit address
  string address = 1;
  // memo: Optional memo for the deposit address
  optional string memo = 2;
}
