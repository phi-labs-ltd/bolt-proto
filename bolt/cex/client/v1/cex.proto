syntax = "proto3";

package bolt.cex.client.v1;

import "bolt/assets/v1/assets.proto";
import "google/protobuf/timestamp.proto";

// Service adapting the CEX communication for Market Maker
service CEXClientService {
  // Queries for balances on CEX accounts
  rpc GetBalances(GetBalancesRequest) returns (GetBalancesResponse);
  // Queries CEX order history
  rpc GetOrderHistory(GetOrderHistoryRequest) returns (GetOrderHistoryResponse);
}

// Request to query balances on CEX accounts for a specific exchange.
// The `exchange` parameter is required and specifies which exchange to query.
message GetBalancesRequest {
  // exchange: The exchange for which to get the balances
  Exchange exchange = 1;
}

// Response to GetBalancesRequest
message GetBalancesResponse {
  // Assets balances
  repeated bolt.assets.v1.Balance balances = 1;
}

// Request to retrieve order history for a specified time period.
message GetOrderHistoryRequest {
  // exchange: The exchange for which to get the history
  Exchange exchange = 1;
  // A specific instrument name to search.
  optional bolt.assets.v1.Pair asset_pair = 2;
  // Start time in Unix time format
  optional google.protobuf.Timestamp start_time = 3;
  // End time in Unix time format
  optional google.protobuf.Timestamp end_time = 4;
}


// Response to GetOrderHistoryRequest
message GetOrderHistoryResponse {
  // Specific exchange to query.
  Exchange = 1;
  oneof cex_response {
    // An optional response from crypto.com
    CryptoResponse = 2;
    // An optional response from gate.io
    GateResponse = 3;
  }
}

message CryptoResponse {
  string account_id = 1;
  string event_date = 2;
  string journal_type = 3;
  Fraction traded_quantity = 4;
  decimal traded_price = 5;
  Fraction fees = 6;
  string order_id = 7;
  string trade_id = 8;
  string trade_match_id = 9;
  string client_oid = 10;
  string taker_side = 11;
  OrderSide side = 12;
  string instrument_name = 13;
  string fee_instrument_name = 14;
  google.protobuf.Timestamp create_time_ms = 15;
  google.protobuf.Timestamp create_time_ns = 16;
  google.protobuf.Timestamp transact_time_ns = 17;
}

message GateResponse {
  Fraction amount = 1;
  google.protobuf.Timestamp create_time_s = 2;
  google.protobuf.Timestamp create_time_ms = 3;
  string currency_pair = 4;
  string deal = 5;
  Fraction fee = 6;
  string fee_currency = 7;
  Fraction gt_fee = 8;
  string id = 9;
  string order_id = 10;
  Fraction point_fee = 11;
  decima price = 12;
  string role = 13;
  string sequence_id = 14;
  OrderSide side = 15;
  string text = 16;
}

message Fraction {
  int64 numerator = 1;
  int64 denominator = 2;
}

// Supported exchanges
enum Exchange {
  // Exchange is not specified - should never be used
  EXCHANGE_UNSPECIFIED = 0;
  // Crypto.com exchange
  EXCHANGE_CRYPTODOTCOM = 1;
  // Gate.io exchange
  EXCHANGE_GATEIO = 2;
}
