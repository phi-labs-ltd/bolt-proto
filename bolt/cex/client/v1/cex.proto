syntax = "proto3";

package bolt.cex.client.v1;

import "bolt/assets/v1/assets.proto";
import "bolt/cex/adapter/v1/cex.proto";
import "bolt/cex/types/v1/types.proto";
import "bolt/common/numeric/v1/numeric.proto";
import "google/protobuf/timestamp.proto";

// Service adapting the CEX communication for Market Maker
service CEXClientService {
  // Queries for balances on CEX accounts
  rpc GetBalances(GetBalancesRequest) returns (GetBalancesResponse);
  // Queries CEX order history
  rpc GetOrderHistory(GetOrderHistoryRequest) returns (GetOrderHistoryResponse);
  // Queries for multiple pairs prices in batch.
  rpc GetPrices(GetPricesRequest) returns (GetPricesResponse);
}

// Request to query balances on CEX accounts for a specific exchange.
// The `exchange` parameter is required and specifies which exchange to query.
message GetBalancesRequest {
  // exchange: The exchange for which to get the balances
  Exchange exchange = 1;
}

// Response to GetBalancesRequest
message GetBalancesResponse {
  // Assets balances
  repeated bolt.assets.v1.Balance balances = 1;
}

// Request to retrieve order history for a specified time period.
message GetOrderHistoryRequest {
  // exchange: The exchange for which to get the history
  Exchange exchange = 1;
  // A specific instrument name to search.
  bolt.assets.v1.Pair asset_pair = 2;
  // Start time in Unix time format
  google.protobuf.Timestamp start_time = 3;
  // End time in Unix time format
  google.protobuf.Timestamp end_time = 4;
}

// List of responses
message GetOrderHistoryResponse {
  // An entry in the response list for an exchange.
  repeated HistoryEntry entries = 1;
}

// Response to GetOrderHistoryRequest
message HistoryEntry {
  // One of exchange responses.
  oneof data {
    // An optional response from crypto.com
    CryptoResponse cdc_response = 1;
    // An optional response from gate.io
    GateResponse gate_response = 2;
  }
}

// Request to retrieve multiple pairs prices for a specific exchange.
message GetPricesRequest {
  // exchange: The exchange for which to get the prices
  Exchange exchange = 1;
  // asset_pair: The market pairs to query. e.g. ATOM/USDT, BTC/USDT
  repeated bolt.assets.v1.Pair asset_pair = 2;
}

// Response to GetPricesRequest
message GetPricesResponse {
  // Key: asset pair string, e.g. "ATOM/USDT"
  map<string, Price> prices = 1;
}

// Price pair for bid/ask of asset.
message Price {
   // price: The bid price of the pair, in rational values. e.g. 1250/13
  bolt.common.numeric.v1.Fraction bid = 1;
   // price: The ask price of the pair, in rational values. e.g. 1250/13
  bolt.common.numeric.v1.Fraction ask = 2;
}

// Response variant specific to crypto.com.
message CryptoResponse {
  // Account ID
  string account_id = 1;
  // Event date
  google.protobuf.Timestamp event_date = 2;
  // Journal type would be TRADING
  bolt.cex.types.v1.JournalType journal_type = 3;
  // Trade quantity
  bolt.common.numeric.v1.Fraction traded_quantity = 4;
  // Trade price
  bolt.common.numeric.v1.Fraction traded_price = 5;
  // Trade fees, the negative sign means a deduction on balance
  bolt.common.numeric.v1.Fraction fees = 6;
  // Order ID
  string order_id = 7;
  // Trade ID
  string trade_id = 8;
  // Trade match ID
  string trade_match_id = 9;
  // Client Order ID
  string client_oid = 10;
  // MAKER or TAKER or empty
  bolt.cex.types.v1.OrderType taker_side = 11;
  // BUY or SELL
  bolt.cex.adapter.v1.OrderSide side = 12;
  // e.g. BTCUSD-PERP
  string instrument_name = 13;
  // e.g. USD
  string fee_instrument_name = 14;
  // Create timestamp in milliseconds
  google.protobuf.Timestamp create_time_ms = 15;
  // Create timestamp in nanoseconds
  google.protobuf.Timestamp create_time_ns = 16;
  // Trade transaction time in nanoseconds
  google.protobuf.Timestamp transact_time_ns = 17;
}

// Response variant specific to gate.io.
message GateResponse {
  // Trade amount
  bolt.common.numeric.v1.Fraction amount = 1;
  // Fill Time
  google.protobuf.Timestamp create_time_s = 2;
  // Trading time, with millisecond precision
  google.protobuf.Timestamp create_time_ms = 3;
  // Currency pair
  string currency_pair = 4;
  // Total Executed Value
  bolt.common.numeric.v1.Fraction deal = 5;
  // Fee deducted, not returned in public endpoints
  bolt.common.numeric.v1.Fraction fee = 6;
  // Fee currency unit, not returned in public endpoints
  string fee_currency = 7;
  // GT used to deduct fee, not returned in public endpoints
  bolt.common.numeric.v1.Fraction gt_fee = 8;
  // Fill ID
  string id = 9;
  // Related order ID, not returned in public endpoints
  string order_id = 10;
  // Points used to deduct fee, not returned in public endpoints
  bolt.common.numeric.v1.Fraction point_fee = 11;
  // Order price
  bolt.common.numeric.v1.Fraction price = 12;
  // Trade role, not returned in public endpoints
  bolt.cex.types.v1.OrderType role = 13;
  // Consecutive trade ID within a single market.
  string sequence_id = 14;
  // Buy or sell order
  bolt.cex.adapter.v1.OrderSide side = 15;
  // User-defined information, not returned in public endpoints
  string text = 16;
}

// Supported exchanges
enum Exchange {
  // Exchange is not specified - should never be used
  EXCHANGE_UNSPECIFIED = 0;
  // Crypto.com exchange
  EXCHANGE_CRYPTODOTCOM = 1;
  // Gate.io exchange
  EXCHANGE_GATEIO = 2;
}
